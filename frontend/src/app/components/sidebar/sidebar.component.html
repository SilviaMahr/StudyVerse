<div class="layout">
  <aside class="sidebar" id="sidebar" #sidebar>
    <div class="toggle-button" (click)="toggleSidebar()">
      <img id ="toggleIcon"
           alt="Sidebar schließen"
           src="assets/closeSidebarIcon.png"
           class= "sidebar-icon"
           #toggleIcon>
    </div>
    <ul>
      <li>
        <a routerLink="/landing">
          <img src="assets/addIcon.png"
               alt="neue Planung hinzufügen"
               class="sidebar-icon">
          neue Planung
        </a>
      </li>
    </ul>

    <ul class="edit-profile">
      <li>
        <a routerLink="/profile">
          <img src="assets/penIcon.png"
               alt="Profil bearbeiten"
               class="sidebar-icon">
          Profil bearbeiten
        </a>
      </li>
      <li>
        <a routerLink="/help">
          <img src="assets/helpIcon.png"
               alt="Hilfe"
               class="sidebar-icon">
          Hilfe
        </a>
      </li>
    </ul>

    <h3>Letzte Planungen</h3>

    @if (deleteMessage) {
      <div class="delete-message">{{ deleteMessage }}</div>
    } @else if (isLoading) {
      <div class="sidebar-loading">Lade Planungen...</div>
    } @else if (error) {
      <div class="sidebar-error">{{ error }}</div>
    }

    @if (!isLoading && !error && recentPlannings.length > 0) {
      <ul class="planning-list">

        @for (plan of recentPlannings; track plan.id) {
          <li class="planning-list-item">
            <a class ="plan-link" [routerLink]="['/plan', plan.id]">
              <span class="plan-title">{{ plan.title }}</span>
            </a>
            <button class="delete-plan-btn"
                    title="Planung löschen"
                    (click)="openDeleteModal($event, plan)">
              <img src="assets/deleteIcon.png" alt="Löschen" class="delete-icon">
            </button>
          </li>
        }
      </ul>
    } @else if (!isLoading && !error && recentPlannings.length === 0) {
      <p class="empty-message">Noch keine Planungen erstellt.</p>
    }


    <div class="mode-toggle">
      <img [src]="themeService.lightIconPath$ | async"
           alt="Helles Erscheinungsbild"
           id="lightModeBtn"
           class="mode-icon"
           (click)="toggleDarkMode()">
      <img [src]="themeService.darkIconPath$ | async"
           alt="Dunkles Erscheinungsbild"
           id="nightModeBtn"
           class="mode-icon"
           (click)="toggleLightMode()"
      >
    </div>
  </aside>
</div>

@if (showDeleteModal && planToDelete) {

  <div class="modal-overlay" (click)="closeDeleteModal()">

    <div class="modal-box" (click)="$event.stopPropagation()">
      <h3>Planung löschen</h3>
      <p>
        Möchtest du die Planung <strong>"{{ planToDelete.title }}"</strong> wirklich endgültig löschen?
      </p>

      <div class="modal-buttons">
        <button (click)="closeDeleteModal()" class="modal-btn-cancel">
          Abbrechen
        </button>
        <button (click)="confirmDelete()" class="modal-btn-confirm">
          Löschen
        </button>
      </div>
    </div>

  </div>
}
